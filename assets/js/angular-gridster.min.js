!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["angular"],t):"object"==typeof exports?module.exports=t(require("angular")):t(e.angular)}(this,function(e){"use strict";return e.module("gridster",[]).constant("gridsterConfig",{columns:6,dynamicColumns:!1,minWidthToAddANewColumn:140,pushing:!0,floating:!0,swapping:!1,width:"auto",colWidth:"auto",rowHeight:"match",margins:[10,10],outerMargin:!0,sparse:!1,isMobile:!1,mobileBreakPoint:600,mobileModeEnabled:!0,minColumns:1,minRows:1,maxRows:100,defaultSizeX:2,defaultSizeY:1,minSizeX:1,maxSizeX:null,minSizeY:1,maxSizeY:null,saveGridItemCalculatedHeightInMobile:!1,resizable:{enabled:!0,handles:["s","e","n","w","se","ne","sw","nw"]},draggable:{enabled:!0,scrollSensitivity:20,scrollSpeed:15}}).controller("GridsterCtrl",["gridsterConfig","$timeout",function(t,i){var r=this;e.extend(this,t),this.resizable=e.extend({},t.resizable||{}),this.draggable=e.extend({},t.draggable||{});var n=!1;this.layoutChanged=function(){n||(n=!0,i(function(){n=!1,r.loaded&&r.floatItemsUp(),r.updateHeight(r.movingItem?r.movingItem.sizeY:0)},30))},this.grid=[],this.allItems=[],this.destroy=function(){this.grid&&(this.grid=[]),this.$element=null,this.allItems&&(this.allItems.length=0,this.allItems=null)},this.setOptions=function(t){if(t)if((t=e.extend({},t)).draggable&&(e.extend(this.draggable,t.draggable),delete t.draggable),t.resizable&&(e.extend(this.resizable,t.resizable),delete t.resizable),e.extend(this,t),this.margins&&2===this.margins.length)for(var i=0,r=this.margins.length;i<r;++i)this.margins[i]=parseInt(this.margins[i],10),isNaN(this.margins[i])&&(this.margins[i]=0);else this.margins=[0,0]},this.canItemOccupy=function(e,t,i){return t>-1&&i>-1&&e.sizeX+i<=this.columns&&e.sizeY+t<=this.maxRows},this.autoSetItemPosition=function(e){for(var t=0;t<this.maxRows;++t)for(var i=0;i<this.columns;++i){if(0===this.getItems(t,i,e.sizeX,e.sizeY,e).length&&this.canItemOccupy(e,t,i))return void this.putItem(e,t,i)}throw new Error("Unable to place item!")},this.getItems=function(e,t,i,r,n){var s,o=[];if(i&&r||(i=r=1),!n||n instanceof Array||(n=[n]),!1===this.sparse)for(var a=0;a<r;++a)for(var l=0;l<i;++l)!(s=this.getItem(e+a,t+l,n))||n&&-1!==n.indexOf(s)||-1!==o.indexOf(s)||o.push(s);else for(var d=e+r-1,h=t+i-1,u=0;u<this.allItems.length;++u)!(s=this.allItems[u])||n&&-1!==n.indexOf(s)||-1!==o.indexOf(s)||!this.intersect(s,t,h,e,d)||o.push(s);return o},this.getBoundingBox=function(e){if(0===e.length)return null;if(1===e.length)return{row:e[0].row,col:e[0].col,sizeY:e[0].sizeY,sizeX:e[0].sizeX};for(var t=0,i=0,r=9999,n=9999,s=0,o=e.length;s<o;++s){var a=e[s];r=Math.min(a.row,r),n=Math.min(a.col,n),t=Math.max(a.row+a.sizeY,t),i=Math.max(a.col+a.sizeX,i)}return{row:r,col:n,sizeY:t-r,sizeX:i-n}},this.intersect=function(e,t,i,r,n){return t<=e.col+e.sizeX-1&&i>=e.col&&r<=e.row+e.sizeY-1&&n>=e.row},this.removeItem=function(e){for(var t,i=0,r=this.grid.length;i<r;++i){var n=this.grid[i];if(n&&-1!==(t=n.indexOf(e))){n[t]=null;break}}this.sparse&&-1!==(t=this.allItems.indexOf(e))&&this.allItems.splice(t,1),this.layoutChanged()},this.getItem=function(e,t,i){!i||i instanceof Array||(i=[i]);for(var r=1;e>-1;){for(var n=1,s=t;s>-1;){var o=this.grid[e];if(o){var a=o[s];if(a&&(!i||-1===i.indexOf(a))&&a.sizeX>=n&&a.sizeY>=r)return a}++n,--s}--e,++r}return null},this.putItems=function(e){for(var t=0,i=e.length;t<i;++t)this.putItem(e[t])},this.putItem=function(e,t,i,r){if(void 0!==t&&null!==t||(t=e.row,i=e.col,void 0!==t&&null!==t)){if(this.canItemOccupy(e,t,i)||(i=Math.min(this.columns-e.sizeX,Math.max(0,i)),t=Math.min(this.maxRows-e.sizeY,Math.max(0,t))),null!==e.oldRow&&void 0!==e.oldRow){var n=e.oldRow===t&&e.oldColumn===i,s=this.grid[t]&&this.grid[t][i]===e;if(n&&s)return e.row=t,void(e.col=i);var o=this.grid[e.oldRow];o&&o[e.oldColumn]===e&&delete o[e.oldColumn]}e.oldRow=e.row=t,e.oldColumn=e.col=i,this.moveOverlappingItems(e,r),this.grid[t]||(this.grid[t]=[]),this.grid[t][i]=e,this.sparse&&-1===this.allItems.indexOf(e)&&this.allItems.push(e),this.movingItem===e&&this.floatItemUp(e),this.layoutChanged()}else this.autoSetItemPosition(e)},this.swapItems=function(e,t){this.grid[e.row][e.col]=t,this.grid[t.row][t.col]=e;var i=e.row,r=e.col;e.row=t.row,e.col=t.col,t.row=i,t.col=r},this.moveOverlappingItems=function(e,t){t?-1===t.indexOf(e)&&(t=t.slice(0)).push(e):t=[e];var i=this.getItems(e.row,e.col,e.sizeX,e.sizeY,t);this.moveItemsDown(i,e.row+e.sizeY,t)},this.moveItemsDown=function(e,t,i){if(e&&0!==e.length){e.sort(function(e,t){return e.row-t.row}),i=i?i.slice(0):[];var r,n,s,o={};for(n=0,s=e.length;n<s;++n){var a=o[(r=e[n]).col];(void 0===a||r.row<a)&&(o[r.col]=r.row)}for(n=0,s=e.length;n<s;++n){var l=t-o[(r=e[n]).col];this.moveItemDown(r,r.row+l,i),i.push(r)}}},this.moveItemDown=function(e,t,i){if(!(e.row>=t)){for(;e.row<t;)++e.row,this.moveOverlappingItems(e,i);this.putItem(e,e.row,e.col,i)}},this.floatItemsUp=function(){if(!1!==this.floating)for(var e=0,t=this.grid.length;e<t;++e){var i=this.grid[e];if(i)for(var r=0,n=i.length;r<n;++r){var s=i[r];s&&this.floatItemUp(s)}}},this.floatItemUp=function(e){if(!1!==this.floating){for(var t=e.col,i=e.sizeY,r=e.sizeX,n=null,s=null,o=e.row-1;o>-1;){if(0!==this.getItems(o,t,r,i,e).length)break;n=o,s=t,--o}null!==n&&this.putItem(e,n,s)}},this.updateHeight=function(e){var t=this.minRows;e=e||0;for(var i=this.grid.length;i>=0;--i){var r=this.grid[i];if(r)for(var n=0,s=r.length;n<s;++n)r[n]&&(t=Math.max(t,i+e+r[n].sizeY))}this.gridHeight=this.maxRows-t>0?Math.min(this.maxRows,t):Math.max(this.maxRows,t)},this.updateColumnLayout=function(){for(var e=[],t=0,i=r.grid.length;t<i;++t){var n=r.grid[t];if(n)for(var s=0,o=n.length;s<o;++s)if(n[s]){var a=n[s];void 0!==a.preferredX&&(a.sizeX=a.preferredX,a.sizeY=a.preferredY),a.sizeX>r.columns?(a.preferredX=a.sizeX,a.preferredY=a.sizeY,a.sizeX=r.columns,a.sizeY=Math.round(a.sizeX*a.sizeY/a.preferredX),a.sizeY=a.sizeY>0?a.sizeY:1,e.push(a)):a.col+a.sizeX>r.columns?e.push(a):r.autoSetItemPosition(a)}}for(var l=0,d=e.length;l<d;++l)r.autoSetItemPosition(e[l]);e.length=0},this.pixelsToRows=function(e,t){return this.outerMargin||(e+=this.margins[0]/2),!0===t?Math.ceil(e/this.curRowHeight):!1===t?Math.floor(e/this.curRowHeight):Math.round(e/this.curRowHeight)},this.pixelsToColumns=function(e,t){return this.outerMargin||(e+=this.margins[1]/2),!0===t?Math.ceil(e/this.curColWidth):!1===t?Math.floor(e/this.curColWidth):Math.round(e/this.curColWidth)}}]).directive("gridsterPreview",function(){return{replace:!0,scope:!0,require:"^gridster",template:'<div ng-style="previewStyle()" class="gridster-item gridster-preview-holder"></div>',link:function(e,t,i,r){e.previewStyle=function(){return r.movingItem?{display:"block",height:r.movingItem.sizeY*r.curRowHeight-r.margins[0]+"px",width:r.movingItem.sizeX*r.curColWidth-r.margins[1]+"px",top:r.movingItem.row*r.curRowHeight+(r.outerMargin?r.margins[0]:0)+"px",left:r.movingItem.col*r.curColWidth+(r.outerMargin?r.margins[1]:0)+"px"}:{display:"none"}}}}}).directive("gridster",["$timeout","$window","$rootScope","gridsterDebounce",function(t,i,r,n){return{scope:!0,restrict:"EAC",controller:"GridsterCtrl",controllerAs:"gridster",compile:function(s){return s.prepend('<div ng-if="gridster.movingItem" gridster-preview></div>'),function(s,o,a,l){l.loaded=!1,l.$element=o,s.gridster=l,o.addClass("gridster");var d=function(e){return"hidden"!==e.style.visibility&&"none"!==e.style.display};function h(){o.css("height",l.gridHeight*l.curRowHeight+(l.outerMargin?l.margins[0]:-l.margins[0])+"px")}function u(){if(l.dynamicColumns){var e=o[0].offsetWidth||parseInt(o.css("width"),10);if(!e)return;var t=(l.outerMargin?2:1)*l.margins[1]+parseInt(l.minWidthToAddANewColumn,10),i=Math.floor(e/t);i<l.minColumns&&(i=l.minColumns),i!==l.columns&&(l.columns=i)}}function c(e){if(l.setOptions(e),d(o[0])){"auto"===l.width?l.curWidth=o[0].offsetWidth||parseInt(o.css("width"),10):l.curWidth=l.width,"auto"===l.colWidth?l.curColWidth=(l.curWidth+(l.outerMargin?-l.margins[1]:l.margins[1]))/l.columns:l.curColWidth=l.colWidth,l.curRowHeight=l.rowHeight,"string"==typeof l.rowHeight&&("match"===l.rowHeight?l.curRowHeight=Math.round(l.curColWidth):-1!==l.rowHeight.indexOf("*")?l.curRowHeight=Math.round(l.curColWidth*l.rowHeight.replace("*","").replace(" ","")):-1!==l.rowHeight.indexOf("/")&&(l.curRowHeight=Math.round(l.curColWidth/l.rowHeight.replace("/","").replace(" ","")))),l.isMobile=l.mobileModeEnabled&&l.curWidth<=l.mobileBreakPoint;for(var t=0,i=l.grid.length;t<i;++t){var r=l.grid[t];if(r)for(var n=0,s=r.length;n<s;++n)if(r[n]){var a=r[n];a.setElementPosition(),a.setElementSizeY(),a.setElementSizeX()}}h()}}s.$watch(function(){return l.gridHeight},h),s.$watch(function(){return l.movingItem},function(){l.updateHeight(l.movingItem?l.movingItem.sizeY:0)});var g=a.gridster;g?s.$parent.$watch(g,function(e){c(e)},!0):c({}),s.$watch(function(){return l.loaded},function(){l.loaded?(o.addClass("gridster-loaded"),r.$broadcast("gridster-loaded",l)):o.removeClass("gridster-loaded")}),s.$watch(function(){return l.isMobile},function(){l.isMobile?o.addClass("gridster-mobile").removeClass("gridster-desktop"):o.removeClass("gridster-mobile").addClass("gridster-desktop"),r.$broadcast("gridster-mobile-changed",l)}),s.$watch(function(){return l.draggable},function(){r.$broadcast("gridster-draggable-changed",l)},!0),s.$watch(function(){return l.resizable},function(){r.$broadcast("gridster-resizable-changed",l)},!0),s.$watch(function(){return l.columns},function(){r.$broadcast("gridster-columns-changed",l)}),s.$watch(function(){return l.dynamicColumns},function(){u(),c()}),s.$watch(function(){return l.minWidthToAddANewColumn},function(){u(),c()});var m=o[0].offsetWidth||parseInt(o.css("width"),10),f=function(){var e=o[0].offsetWidth||parseInt(o.css("width"),10);e&&e!==m&&!l.movingItem&&(m=e,u(),l.loaded&&o.removeClass("gridster-loaded"),c(),l.loaded&&o.addClass("gridster-loaded"),r.$broadcast("gridster-resized",[e,o[0].offsetHeight],l))},v=n(function(){f(),t(function(){s.$apply()})},100);s.$watch(function(){return d(o[0])},v),"function"==typeof window.addResizeListener?window.addResizeListener(o[0],v):s.$watch(function(){return o[0].offsetWidth||parseInt(o.css("width"),10)},f);var p=e.element(i);p.on("resize",v),s.$on("$destroy",function(){l.destroy(),p.off("resize",v),"function"==typeof window.removeResizeListener&&window.removeResizeListener(o[0],v)}),t(function(){s.$watch("gridster.floating",function(){l.floatItemsUp()}),l.loaded=!0},100)}}}}]).controller("GridsterItemCtrl",function(){this.$element=null,this.gridster=null,this.row=null,this.col=null,this.sizeX=null,this.sizeY=null,this.minSizeX=0,this.minSizeY=0,this.maxSizeX=null,this.maxSizeY=null,this.init=function(e,t){this.$element=e,this.gridster=t,this.sizeX=t.defaultSizeX,this.sizeY=t.defaultSizeY},this.destroy=function(){this.gridster=null,this.$element=null},this.toJSON=function(){return{row:this.row,col:this.col,sizeY:this.sizeY,sizeX:this.sizeX}},this.isMoving=function(){return this.gridster.movingItem===this},this.setPosition=function(e,t){this.gridster.putItem(this,e,t),this.isMoving()||this.setElementPosition()},this.setSize=function(e,t,i){var r="size"+(e=e.toUpperCase()),n="Size"+e;if(""!==t){t=parseInt(t,10),(isNaN(t)||0===t)&&(t=this.gridster["default"+n]);var s="X"===e?this.gridster.columns:this.gridster.maxRows;this["max"+n]&&(s=Math.min(this["max"+n],s)),this.gridster["max"+n]&&(s=Math.min(this.gridster["max"+n],s)),"X"===e&&this.cols?s-=this.cols:"Y"===e&&this.rows&&(s-=this.rows);var o=0;this["min"+n]&&(o=Math.max(this["min"+n],o)),this.gridster["min"+n]&&(o=Math.max(this.gridster["min"+n],o)),t=Math.max(Math.min(t,s),o);var a=this[r]!==t||this["old"+n]&&this["old"+n]!==t;return this["old"+n]=this[r]=t,this.isMoving()||this["setElement"+n](),!i&&a&&(this.gridster.moveOverlappingItems(this),this.gridster.layoutChanged()),a}},this.setSizeY=function(e,t){return this.setSize("Y",e,t)},this.setSizeX=function(e,t){return this.setSize("X",e,t)},this.setElementPosition=function(){this.gridster.isMobile?this.$element.css({marginLeft:this.gridster.margins[0]+"px",marginRight:this.gridster.margins[0]+"px",marginTop:this.gridster.margins[1]+"px",marginBottom:this.gridster.margins[1]+"px",top:"",left:""}):this.$element.css({margin:0,top:this.row*this.gridster.curRowHeight+(this.gridster.outerMargin?this.gridster.margins[0]:0)+"px",left:this.col*this.gridster.curColWidth+(this.gridster.outerMargin?this.gridster.margins[1]:0)+"px"})},this.setElementSizeY=function(){this.gridster.isMobile&&!this.gridster.saveGridItemCalculatedHeightInMobile?this.$element.css("height",""):this.$element.css("height",this.sizeY*this.gridster.curRowHeight-this.gridster.margins[0]+"px")},this.setElementSizeX=function(){this.gridster.isMobile?this.$element.css("width",""):this.$element.css("width",this.sizeX*this.gridster.curColWidth-this.gridster.margins[1]+"px")},this.getElementSizeX=function(){return this.sizeX*this.gridster.curColWidth-this.gridster.margins[1]},this.getElementSizeY=function(){return this.sizeY*this.gridster.curRowHeight-this.gridster.margins[0]}}).factory("GridsterTouch",[function(){return function(e,t,i,r){var n,s,o={},a=function(e){if(Object.keys)return Object.keys(e).length;var t,i=0;for(t in e)++i;return i},l=function(e){for(var t=0,i=0,r=navigator.userAgent.match(/\bMSIE\b/),n=e;null!=n;n=n.offsetParent)r&&(!document.documentMode||document.documentMode<8)&&"relative"===n.currentStyle.position&&n.offsetParent&&"relative"===n.offsetParent.currentStyle.position&&n.offsetLeft===n.offsetParent.offsetLeft?i+=n.offsetTop:(t+=n.offsetLeft,i+=n.offsetTop);return{x:t,y:i}},d=l(e),h=!1,u=function(n){if("mousemove"!==n.type||0!==a(o)){for(var s=!0,c=n.changedTouches?n.changedTouches:[n],g=0;g<c.length;++g){var m=c[g],f=void 0!==m.identifier?m.identifier:void 0!==m.pointerId?m.pointerId:1;if(void 0===m.pageX)if(m.pageX=m.offsetX+d.x,m.pageY=m.offsetY+d.y,m.srcElement.offsetParent===e&&document.documentMode&&8===document.documentMode&&"mousedown"===m.type)m.pageX+=m.srcElement.offsetLeft,m.pageY+=m.srcElement.offsetTop;else if(m.srcElement!==e&&!document.documentMode||document.documentMode<8){for(var v=-2,p=-2,w=m.srcElement;null!==w;w=w.parentNode)v+=w.scrollLeft?w.scrollLeft:0,p+=w.scrollTop?w.scrollTop:0;m.pageX=m.clientX+v,m.pageY=m.clientY+p}var z=m.pageX,b=m.pageY;n.type.match(/(start|down)$/i)?(d=l(e),o[f]&&(r&&r({target:n.target,which:n.which,pointerId:f,pageX:z,pageY:b}),delete o[f]),t&&s&&(s=t({target:n.target,which:n.which,pointerId:f,pageX:z,pageY:b})),o[f]={x:z,y:b},e.msSetPointerCapture&&s?e.msSetPointerCapture(f):"mousedown"===n.type&&1===a(o)&&(h?e.setCapture(!0):(document.addEventListener("mousemove",u,!1),document.addEventListener("mouseup",u,!1)))):n.type.match(/move$/i)?!o[f]||o[f].x===z&&o[f].y===b||(i&&s&&(s=i({target:n.target,which:n.which,pointerId:f,pageX:z,pageY:b})),o[f].x=z,o[f].y=b):o[f]&&n.type.match(/(up|end|cancel)$/i)&&(r&&s&&(s=r({target:n.target,which:n.which,pointerId:f,pageX:z,pageY:b})),delete o[f],e.msReleasePointerCapture?e.msReleasePointerCapture(f):"mouseup"===n.type&&0===a(o)&&(h?e.releaseCapture():(document.removeEventListener("mousemove",u,!1),document.removeEventListener("mouseup",u,!1))))}s&&(n.preventDefault&&n.preventDefault(),n.preventManipulation&&n.preventManipulation(),n.preventMouseEvent&&n.preventMouseEvent())}};return this.enable=function(){window.navigator.msPointerEnabled?(e.addEventListener("MSPointerDown",u,!1),e.addEventListener("MSPointerMove",u,!1),e.addEventListener("MSPointerUp",u,!1),e.addEventListener("MSPointerCancel",u,!1),void 0!==e.style.msContentZooming&&(n=e.style.msContentZooming,e.style.msContentZooming="none"),void 0!==e.style.msTouchAction&&(s=e.style.msTouchAction,e.style.msTouchAction="none")):e.addEventListener?(e.addEventListener("touchstart",u,!1),e.addEventListener("touchmove",u,!1),e.addEventListener("touchend",u,!1),e.addEventListener("touchcancel",u,!1),e.addEventListener("mousedown",u,!1),e.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(h=!0,e.addEventListener("mousemove",u,!1),e.addEventListener("mouseup",u,!1))):e.attachEvent&&e.setCapture&&(h=!0,e.attachEvent("onmousedown",function(){return u(window.event),window.event.returnValue=!1,!1}),e.attachEvent("onmousemove",function(){return u(window.event),window.event.returnValue=!1,!1}),e.attachEvent("onmouseup",function(){return u(window.event),window.event.returnValue=!1,!1}))},this.disable=function(){window.navigator.msPointerEnabled?(e.removeEventListener("MSPointerDown",u,!1),e.removeEventListener("MSPointerMove",u,!1),e.removeEventListener("MSPointerUp",u,!1),e.removeEventListener("MSPointerCancel",u,!1),n&&(e.style.msContentZooming=n),s&&(e.style.msTouchAction=s)):e.removeEventListener?(e.removeEventListener("touchstart",u,!1),e.removeEventListener("touchmove",u,!1),e.removeEventListener("touchend",u,!1),e.removeEventListener("touchcancel",u,!1),e.removeEventListener("mousedown",u,!1),e.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(h=!0,e.removeEventListener("mousemove",u,!1),e.removeEventListener("mouseup",u,!1))):e.detachEvent&&e.setCapture&&(h=!0,e.detachEvent("onmousedown"),e.detachEvent("onmousemove"),e.detachEvent("onmouseup"))},this}}]).factory("GridsterDraggable",["$document","$window","GridsterTouch",function(t,i,r){return function(n,s,o,a,l){var d,h,u,c,g=0,m=0,f=0,v=0,p=0,w=0,z=0,b=0,y=t[0],I=["select","option","input","textarea","button"];function x(t){if(-1!==I.indexOf(t.target.nodeName.toLowerCase()))return!1;var i,r=e.element(t.target);if(r.hasClass("gridster-item-resizable-handler"))return!1;if(r.attr("onclick")||r.attr("ng-click"))return!1;if(r.closest&&r.closest(".gridster-no-drag").length)return!1;if(o.draggable&&o.draggable.handle){var g=e.element(n[0].querySelectorAll(o.draggable.handle)),m=!1;e:for(var p=0,w=g.length;p<w;++p){var z=g[p];if(z===t.target){m=!0;break}for(var b=t.target,y=0;y<20;++y){var x=b.parentNode;if(x===n[0]||!x)break;if(x===z){m=!0;break e}b=x}}if(!m)return!1}switch(t.which){case 1:break;case 2:case 3:return}return f=t.pageX,v=t.pageY,d=parseInt(n.css("left"),10),h=parseInt(n.css("top"),10),u=n[0].offsetWidth,c=n[0].offsetHeight,a.col,a.row,i=t,n.addClass("gridster-item-moving"),o.movingItem=a,o.updateHeight(a.sizeY),s.$apply(function(){o.draggable&&o.draggable.start&&o.draggable.start(i,n,l,a)}),!0}function Y(e){if(!n.hasClass("gridster-item-moving")||n.hasClass("gridster-item-resizing"))return!1;var t=o.curWidth-1,r=o.curRowHeight*o.maxRows-1;g=e.pageX,m=e.pageY;var I=g-f+p,x=m-v+w;p=w=0,f=g,v=m;var Y=I,C=x;return d+Y<b?p=Y-(I=b-d):d+u+Y>t&&(p=Y-(I=t-d-u)),h+C<z?w=C-(x=z-h):h+c+C>r&&(w=C-(x=r-h-c)),d+=I,h+=x,n.css({top:h+"px",left:d+"px"}),function(e){var t=a.row,r=a.col,u=o.draggable&&o.draggable.drag,c=o.draggable.scrollSensitivity,g=o.draggable.scrollSpeed,m=Math.min(o.pixelsToRows(h),o.maxRows-1),f=Math.min(o.pixelsToColumns(d),o.columns-1),v=o.getItems(m,f,a.sizeX,a.sizeY,a),p=0!==v.length;if(!0===o.swapping&&p){var w=o.getBoundingBox(v),z=w.sizeX===a.sizeX&&w.sizeY===a.sizeY,b=w.row===t,I=w.col===r,x=w.row===m&&w.col===f,Y=b||I;if(z&&1===v.length){if(x)o.swapItems(a,v[0]);else if(Y)return}else if(w.sizeX<=a.sizeX&&w.sizeY<=a.sizeY&&Y)for(var C=a.row<=m?a.row:m+a.sizeY,X=a.col<=f?a.col:f+a.sizeX,M=C-w.row,S=X-w.col,E=0,$=v.length;E<$;++E){var L=v[E];0===o.getItems(L.row+M,L.col+S,L.sizeX,L.sizeY,a).length&&o.putItem(L,L.row+M,L.col+S)}}!1===o.pushing&&p||(a.row=m,a.col=f),e.pageY-y.body.scrollTop<c?y.body.scrollTop=y.body.scrollTop-g:i.innerHeight-(e.pageY-y.body.scrollTop)<c&&(y.body.scrollTop=y.body.scrollTop+g),e.pageX-y.body.scrollLeft<c?y.body.scrollLeft=y.body.scrollLeft-g:i.innerWidth-(e.pageX-y.body.scrollLeft)<c&&(y.body.scrollLeft=y.body.scrollLeft+g),(u||t!==a.row||r!==a.col)&&s.$apply(function(){u&&o.draggable.drag(e,n,l,a)})}(e),!0}function C(e){return!(!n.hasClass("gridster-item-moving")||n.hasClass("gridster-item-resizing")||(p=w=0,function(e){n.removeClass("gridster-item-moving");var t=Math.min(o.pixelsToRows(h),o.maxRows-1),i=Math.min(o.pixelsToColumns(d),o.columns-1);!1===o.pushing&&0!==o.getItems(t,i,a.sizeX,a.sizeY,a).length||(a.row=t,a.col=i),o.movingItem=null,a.setPosition(a.row,a.col),s.$apply(function(){o.draggable&&o.draggable.stop&&o.draggable.stop(e,n,l,a)})}(e),0))}var X=null,M=null;this.enable=function(){!0!==X&&(X=!0,M?M.enable():(M=new r(n[0],x,Y,C)).enable())},this.disable=function(){!1!==X&&(X=!1,M&&M.disable())},this.toggle=function(e){e?this.enable():this.disable()},this.destroy=function(){this.disable()}}}]).factory("GridsterResizable",["GridsterTouch",function(t){return function(i,r,n,s,o){function a(a){var l,d,h,u,c,g=a,m=0,f=0,v=0,p=0,w=0,z=0,b=0,y=9999,I=0,x=function(){return(s.minSizeY?s.minSizeY:1)*n.curRowHeight-n.margins[0]},Y=function(){return(s.minSizeX?s.minSizeX:1)*n.curColWidth-n.margins[1]};function C(e){switch(e.which){case 1:break;case 2:case 3:return}var t;return(c=n.draggable.enabled)&&(n.draggable.enabled=!1,r.$broadcast("gridster-draggable-changed",n)),v=e.pageX,p=e.pageY,l=parseInt(i.css("left"),10),d=parseInt(i.css("top"),10),h=i[0].offsetWidth,u=i[0].offsetHeight,s.sizeX,s.sizeY,t=e,i.addClass("gridster-item-moving"),i.addClass("gridster-item-resizing"),n.movingItem=s,s.setElementSizeX(),s.setElementSizeY(),s.setElementPosition(),n.updateHeight(1),r.$apply(function(){n.resizable&&n.resizable.start&&n.resizable.start(t,i,o,s)}),!0}function X(e){var t=n.curWidth-1;m=e.pageX,f=e.pageY;var c=m-v+w,C=f-p+z;w=z=0,v=m,p=f;var X=C,M=c;return g.indexOf("n")>=0&&(u-X<x()?(C=u-x(),z=X-C):d+X<b&&(z=X-(C=b-d)),d+=C,u-=C),g.indexOf("s")>=0&&(u+X<x()?(C=x()-u,z=X-C):d+u+X>y&&(z=X-(C=y-d-u)),u+=C),g.indexOf("w")>=0&&(h-M<Y()?(c=h-Y(),w=M-c):l+M<I&&(w=M-(c=I-l)),l+=c,h-=c),g.indexOf("e")>=0&&(h+M<Y()?(c=Y()-h,w=M-c):l+h+M>t&&(w=M-(c=t-l-h)),h+=c),i.css({top:d+"px",left:l+"px",width:h+"px",height:u+"px"}),function(e){var t=s.row,c=s.col,g=s.sizeX,m=s.sizeY,f=n.resizable&&n.resizable.resize,v=s.col;-1!==["w","nw","sw"].indexOf(a)&&(v=n.pixelsToColumns(l,!1));var p=s.row;-1!==["n","ne","nw"].indexOf(a)&&(p=n.pixelsToRows(d,!1));var w=s.sizeX;-1===["n","s"].indexOf(a)&&(w=n.pixelsToColumns(h,!0));var z=s.sizeY;-1===["e","w"].indexOf(a)&&(z=n.pixelsToRows(u,!0)),!(p>-1&&v>-1&&w+v<=n.columns&&z+p<=n.maxRows)||!1===n.pushing&&0!==n.getItems(p,v,w,z,s).length||(s.row=p,s.col=v,s.sizeX=w,s.sizeY=z);var b=s.row!==t||s.col!==c||s.sizeX!==g||s.sizeY!==m;(f||b)&&r.$apply(function(){f&&n.resizable.resize(e,i,o,s)})}(e),!0}function M(e){var t;return n.draggable.enabled!==c&&(n.draggable.enabled=c,r.$broadcast("gridster-draggable-changed",n)),w=z=0,t=e,i.removeClass("gridster-item-moving"),i.removeClass("gridster-item-resizing"),n.movingItem=null,s.setPosition(s.row,s.col),s.setSizeY(s.sizeY),s.setSizeX(s.sizeX),r.$apply(function(){n.resizable&&n.resizable.stop&&n.resizable.stop(t,i,o,s)}),!0}var S,E=null;this.enable=function(){E||(E=e.element('<div class="gridster-item-resizable-handler handle-'+g+'"></div>'),i.append(E)),(S=new t(E[0],C,X,M)).enable()},this.disable=function(){E&&(E.remove(),E=null),S.disable(),S=void 0},this.destroy=function(){this.disable()}}var l=[],d=n.resizable.handles;"string"==typeof d&&(d=n.resizable.handles.split(","));for(var h=!1,u=0,c=d.length;u<c;u++)l.push(new a(d[u]));this.enable=function(){if(!h){for(var e=0,t=l.length;e<t;e++)l[e].enable();h=!0}},this.disable=function(){if(h){for(var e=0,t=l.length;e<t;e++)l[e].disable();h=!1}},this.toggle=function(e){e?this.enable():this.disable()},this.destroy=function(){for(var e=0,t=l.length;e<t;e++)l[e].destroy()}}}]).factory("gridsterDebounce",function(){return function(e,t,i){var r;return function(){var n=this,s=arguments,o=i&&!r;clearTimeout(r),r=setTimeout(function(){r=null,i||e.apply(n,s)},t),o&&e.apply(n,s)}}}).directive("gridsterItem",["$parse","GridsterDraggable","GridsterResizable","gridsterDebounce",function(e,t,i,r){return{scope:!0,restrict:"EA",controller:"GridsterItemCtrl",controllerAs:"gridsterItem",require:["^gridster","gridsterItem"],link:function(n,s,o,a){var l,d=o.gridsterItem,h=a[0],u=a[1];if(n.gridster=h,d){var c=e(d);!(l=c(n)||{})&&c.assign&&(l={row:u.row,col:u.col,sizeX:u.sizeX,sizeY:u.sizeY,minSizeX:0,minSizeY:0,maxSizeX:null,maxSizeY:null},c.assign(n,l))}else l=o;u.init(s,h),s.addClass("gridster-item");for(var g=["minSizeX","maxSizeX","minSizeY","maxSizeY","sizeX","sizeY","row","col"],m={},f=[],v=function(t){var i;if("string"==typeof l[t])i=l[t];else if("string"==typeof l[t.toLowerCase()])i=l[t.toLowerCase()];else{if(!d)return;i=d+"."+t}f.push('"'+t+'":'+i),m[t]=e(i);var r=m[t](n);"number"==typeof r&&(u[t]=r)},p=0,w=g.length;p<w;++p)v(g[p]);var z="{"+f.join(",")+"}";n.$watchCollection(z,function(e,t){for(var i in e){var r=e[i];t[i]!==r&&(r=parseInt(r,10),isNaN(r)||(u[i]=r))}}),n.$watch(function(){return u.row+","+u.col},function(){u.setPosition(u.row,u.col),m.row&&m.row.assign&&m.row.assign(n,u.row),m.col&&m.col.assign&&m.col.assign(n,u.col)}),n.$watch(function(){return u.sizeY+","+u.sizeX+","+u.minSizeX+","+u.maxSizeX+","+u.minSizeY+","+u.maxSizeY},function(){var e=u.setSizeX(u.sizeX,!0);e&&m.sizeX&&m.sizeX.assign&&m.sizeX.assign(n,u.sizeX);var t=u.setSizeY(u.sizeY,!0);t&&m.sizeY&&m.sizeY.assign&&m.sizeY.assign(n,u.sizeY),(e||t)&&(u.gridster.moveOverlappingItems(u),h.layoutChanged(),n.$broadcast("gridster-item-resized",u))});var b=new t(s,n,h,u,l),y=new i(s,n,h,u,l),I=function(){y.toggle(!h.isMobile&&h.resizable&&h.resizable.enabled)};I();var x=function(){b.toggle(!h.isMobile&&h.draggable&&h.draggable.enabled)};x();n.$on("gridster-draggable-changed",x),n.$on("gridster-resizable-changed",I),n.$on("gridster-resized",I),n.$on("gridster-mobile-changed",function(){I(),x()}),n.$on("gridster-columns-changed",function(){h.dynamicColumns&&h.updateColumnLayout()});var Y=r(function(){n.$apply(function(){n.$broadcast("gridster-item-transition-end",u)})},50);return s.on(function(){var e=document.createElement("div"),t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var i in t)if(void 0!==e.style[i])return t[i]}(),Y),n.$broadcast("gridster-item-initialized",u),n.$on("$destroy",function(){try{y.destroy(),b.destroy()}catch(e){}try{h.removeItem(u)}catch(e){}try{u.destroy()}catch(e){}})}}}]).directive("gridsterNoDrag",function(){return{restrict:"A",link:function(e,t){t.addClass("gridster-no-drag")}}})});